{% extends "base.html" %}
{% block title %}Items{% endblock %}
{% block content %}
<h2>Items</h2>
<a href="{{ url_for('add_item') }}" class="btn btn-primary mb-3">Add New Item</a>
<input type="text" id="searchInput" class="form-control mb-3" placeholder="ðŸ” Suche nach Produktname oder Barcode..." onkeyup="filterTable()">

<table class="table table-bordered">
  <thead>
    <tr>
      <th>Produktname</th>
      <th>Barcode</th>
      <th>Purchase Price (â‚¬)</th>
      <th>Selling Price (â‚¬)</th>
      <th>Min Selling Price (â‚¬)</th>
      <th>Quantity</th>
      <th>Description</th>
      <th>Photo</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody>
    {% for item in items %}
    <tr>
      <td>{{ item.product_name }}</td>
      <td>{{ item.barcode }}</td>
      <td>{{ "%.2f"|format(item.purchase_price) }}</td>
      <td>{{ "%.2f"|format(item.selling_price) }}</td>
      <td>{{ "%.2f"|format(item.min_selling_price) }}</td>
      <td>{{ item.quantity }}</td>
      <td>{{ item.description }}</td>
      <td>
        {% if item.photo_link %}
          <img src="{{ item.photo_link }}" width="50" alt="Product photo">
        {% else %}
          No Image
        {% endif %}
      </td>
      <td>
        <a href="{{ url_for('edit_item', barcode=item.barcode) }}" class="btn btn-sm btn-warning">Edit</a>
        
        <form method="POST" action="{{ url_for('delete_item', barcode=item.barcode) }}" style="display:inline" onsubmit="return confirm('Delete this item?');">
          <button class="btn btn-sm btn-danger">Delete</button>
        </form>

        <a 
          href="{{ url_for('barcode_print', barcode_value=item.barcode) }}" 
          class="btn btn-sm btn-outline-primary" 
          target="_blank" 
          title="Code drucken"
          style="width: 36px; height: 36px; padding: 6px; display: inline-flex; align-items: center; justify-content: center;"
        >
          <!-- Bootstrap barcode icon SVG -->
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" class="bi bi-upc" viewBox="0 0 16 16">
            <path d="M1.5 1.5v13h1v-13h-1zm2 0v13h1v-13h-1zm2 0v13h1v-13h-1zm2 0v13h1v-13h-1zm2 0v13h1v-13h-1zm2 0v13h1v-13h-1zm2 0v13h1v-13h-1z"/>
          </svg>
        </a>
      </td>
    </tr>
    {% else %}
    <tr><td colspan="9">No items found.</td></tr>
    {% endfor %}
  </tbody>
</table>
<script>
function filterTable() {
  const input = document.getElementById("searchInput");
  const filter = input.value.toLowerCase();
  const rows = document.querySelectorAll("table tbody tr");

  rows.forEach(row => {
    const productName = row.cells[0].textContent.toLowerCase();
    const barcode = row.cells[1].textContent.toLowerCase();
    row.style.display = productName.includes(filter) || barcode.includes(filter) ? "" : "none";
  });
}
</script>
{% endblock %}
